file:///Users/simon/Documents/GitHub/thilacolomaweb/craft/setup.sh {"mtime":1753351000164,"ctime":1753350999917,"size":2913,"etag":"3eijnsd2030u","orphaned":false,"typeId":""}
#!/bin/bash

# Craft CMS Setup Script voor Thila Coloma

echo "ğŸš€ Craft CMS Setup voor Thila Coloma wordt gestart..."

# Check if we're in the right directory
if [ ! -f "composer.json" ]; then
    echo "âŒ Error: Dit script moet uitgevoerd worden in de craft/ directory"
    exit 1
fi

# Check if Composer is installed
if ! command -v composer &> /dev/null; then
    echo "âŒ Error: Composer is niet geÃ¯nstalleerd. Installeer eerst Composer."
    exit 1
fi

# Check if PHP is installed and version
if ! command -v php &> /dev/null; then
    echo "âŒ Error: PHP is niet geÃ¯nstalleerd."
    exit 1
fi

PHP_VERSION=$(php -r "echo PHP_MAJOR_VERSION.'.'.PHP_MINOR_VERSION;")
if [ "$(printf '%s\n' "8.1" "$PHP_VERSION" | sort -V | head -n1)" != "8.1" ]; then
    echo "âŒ Error: PHP 8.1 of hoger is vereist. Huidige versie: $PHP_VERSION"
    exit 1
fi

echo "âœ… PHP versie $PHP_VERSION gevonden"

# Install Composer dependencies
echo "ğŸ“¦ Composer dependencies installeren..."
composer install --no-dev --optimize-autoloader

if [ $? -ne 0 ]; then
    echo "âŒ Error: Composer install gefaald"
    exit 1
fi

echo "âœ… Composer dependencies geÃ¯nstalleerd"

# Check if .env exists, if not copy from example
if [ ! -f ".env" ]; then
    echo "ğŸ“ .env file aanmaken..."
    cp .env.example .env
    echo "âš ï¸  Vergeet niet je database instellingen te configureren in .env"
else
    echo "âœ… .env file bestaat al"
fi

# Generate security key if not set
if ! grep -q "CRAFT_SECURITY_KEY=" .env || grep -q "CRAFT_SECURITY_KEY=$" .env; then
    echo "ğŸ” Security key genereren..."
    ./craft setup/security-key
    echo "âœ… Security key gegenereerd"
fi

# Make storage directory writable
echo "ğŸ“ Storage directory permissies instellen..."
chmod -R 755 storage/
chmod -R 755 web/cpresources/ 2>/dev/null || mkdir -p web/cpresources && chmod -R 755 web/cpresources/

echo "âœ… Permissies ingesteld"

# Check database connection
echo "ğŸ”Œ Database connectie testen..."
if ./craft setup/db-creds; then
    echo "âœ… Database connectie succesvol"
    
    # Run Craft install
    echo "âš™ï¸  Craft CMS installeren..."
    ./craft install
    
    if [ $? -eq 0 ]; then
        echo "ğŸ‰ Craft CMS is succesvol geÃ¯nstalleerd!"
        echo ""
        echo "ğŸ“‹ Volgende stappen:"
        echo "1. Configureer je webserver om naar de web/ directory te wijzen"
        echo "2. Ga naar /admin om in te loggen"
        echo "3. Maak de benodigde sections en fields aan (zie INSTALLATION.md)"
        echo "4. Migreer je bestaande content"
        echo ""
        echo "ğŸŒ Lokale development server starten met: php -S localhost:8080 -t web/"
    else
        echo "âŒ Craft installatie gefaald"
        exit 1
    fi
else
    echo "âŒ Database connectie gefaald. Controleer je .env instellingen."
    echo "ğŸ’¡ Tip: Zorg ervoor dat je database bestaat en de credentials correct zijn."
    exit 1
fi
